<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>CKEditor 5 – balloon block editor build – development sample</title>
  <style>
    body {
      margin: 20px auto;
    }

    h1 {
      max-width: 870px;
      margin: 1em auto;
    }
  </style>
</head>
<body>

<h1>CKEditor 5 – balloon block editor build – development sample</h1>

<div id="editor">

</div>

<script src="../build/ckeditor.js"></script>
<script src="../build/translations/ja.js"></script>

<script>

	BalloonEditor.create( document.querySelector( '#editor' )).then( editor => {
		window.editor = editor;
		window.env = BalloonEditor.utils.env;
		console.clear();
		console.log( window.editor.ui.componentFactory._components );
		window.editor.ui.componentFactory._components.get( 'gallery' ).callback().on( 'change:galleryIsOn', ( p1, p2, p3 ) => {
			console.log( 'gallery' );
			console.log( p1 );
			console.log( p2 );
			console.log( p3 );
		} );
		window.editor.ui.componentFactory._components.get( 'imagedelete' ).callback().on( 'change:deleteIsOn', ( p1, p2, p3 ) => {
			console.log( 'delete' );
		} );
		window.editor.ui.componentFactory._components.get( 'imagecrop' ).callback().on( 'change:cropIsOn', ( p1, p2, p3 ) => {
			console.log( 'crop' );
			BalloonEditor.utils.fetchLocalImage( editor.model.document.selection.getSelectedElement() )
				.then( ( data ) => {
					console.log( data );
				} )
				.catch( ( err ) => {
					console.log( err );
				} );
		} );
		editor.editing.view.document.on( 'delete', ( evInfo, event ) => {
			console.log( 'yes we can! before', event );
		} );
		editor.editing.view.document.on( 'imageLoaded', ( evInfo, event, p3 ) => {
		} );

	  editor.ui.componentFactory._components.get('beforeimginsert').callback()
		  .on('change:beforeInsert', (p1, p2, p3) => {
		  console.log( 'yes we can! beforeInsert', p1, p2, );
		  });

		editor.plugins.get( 'FileRepository' ).loaders.on( 'add', ( evt, loader ) => {
			loader.on( 'change:uploaded', ( evt, name, uploadedPercent ) => {
				editor.model.change( writer => {
					const carretPosition = editor.model.document.selection.getLastPosition();
					if (carretPosition.nodeAfter && carretPosition.nodeAfter.name !== 'paragraph') {
						const pElement = writer.createElement( 'paragraph' );
						writer.insert( pElement, editor.model.document.selection.getLastPosition() );
					}
				} );
			} );
		} );
	} )
		.catch( error => {
			console.error( 'There was a problem initializing the editor.', error );
		} );
</script>

</body>
</html>
